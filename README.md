# О Sleepsaver
Sleepsaver зайдет на пары в Moodle за вас в соответствии с расписанием и будет периодически обновлять страницу с произвольной задержкой (подробнее о задержке в инструкции). Для РГПУ им. Герцена расписание можно получить автоматически.

Здоровый сон очень важен: от него зависит работа иммунитета, общее самочуствие, физическое и психическое здоровье человека. Не пренебрегайте им!

# Дисклеймер
Автор не несет ответственности за вашу успеваемость или отчисление из университета. Все что вы делаете - на ваш страх и риск.

## Инструкция по установке
### Подготовка
Скачайте все файлы Sleepsaver из этого репозитория и поместите в одну папку. Для работы потребуется установленный браузер Google Chrome (на Windows) или Mozilla Firefox (на Linux). 

**Также потребуются:** 
- [Python 3.6+](https://python-scripts.com/install-python-windows) (Проверить установленную версию: `python -V`)
- Python pip (устанавливается вместе с Python)
- Chrome/Firefox webdriver (прилагается, однако может быть несовместмим с вашей версией браузера)
- Библиотеки Selenium и Requests (см. далее)

### Шаг 1: Откройте командную строку и перейдите в каталог Sleepsaver
**Для Windows**
1) Нажмите `Win + R` и наберите `cmd.exe`
2) Перейдите в папку. Пример команды для папки sleepsaver в загрузках:
`cd C:\Users\[username]\Downloads\sleepsaver`

**Для Linux**
1) Откройте терминал (вы лучше меня знаете, как)
2) Перейдите в папку. Пример команды для папки sleepsaver в загрузках:
`cd ~/Загрузки/sleepsaver`

### Шаг 2: Установите зависимости Sleepsaver и вебдрайвер
**Для Windows**
Введите в консоли:
`pip install -r requirements.txt`

Скопируйте нужный вебдрайвер из папки `windows_drivers` в папку с программой 

**Для Linux**
Введите в терминале:
`pip3 install -r requirements.txt`

Скопируйте нужный вебдрайвер из папки `linux_drivers` в папку с программой

### Шаг 3: Заполните параметры в файле `config.json`
1) Откройте файл конфигурации в любом редакторе кода или блокноте/nano
2) Настройте параметры в соответствии с данной инструкцией:
```
    {
        "group_id": "00000", # пятизначный номер группы. Можно найти в адресе страницы
                                с расписанием вашей группы на https://guide.herzen.spb.ru/
        "subgroup": "0", # номер подгруппы внутри группы. 0 - если нет подгруппы
        "approx_wait_time": 300, # Приблизительный период обновления страницы в секундах.
                                    Будет варьироваться в пределах 25%
        "login": "111111", # Ваш логин в Moodle
        "password": "Password123", # Ваш пароль в Moodle
        "base_url": "https://moodle.herzen.spb.ru/", # не трогайте
        "schedule_provider_url": "https://herzen-timetable.herokuapp.com/api/timetable/group_forCurrentWeek", # не трогайте
        "schedule_expiration_date": "2020-10-01 23:59" # не трогайте
    }
```
**Примечание по поводу вебдрайвера**
- Для разных версий браузера нужны разные версии драйвера, предложенный драйвер может не подойти к вашей версии Chrome / Firefox.
В таком случае ищите в Google: "Chrome / Firefox python selenium webdriver installation guide" и следуйте инструкциям. Другие браузеры не поддерживаются, однако могут заработать. Пробуйте. 
- Пользователи Linux не пишут расширение файла и не забывают выдать ему права на исполнение: `sudo chmod +x filename`

3) Сохраните файл и закройте текстовый редактор

### Шаг 4: Прверьте правильность настройки вебдрайвера и Selenium
Запустите `webdriver_test.py`. Скрипт прочитает настройки из файла конфигурации и попытается открыть на 5 секунд сайт Google. Если все настроено правильно - вы увидите, как откроется и закроется браузер и в консоли появится сообщение об успешном завершении теста.

**Для Windows**
Наберите команду `python webdriver_test.py`
Брандмауер может запросить разрешение на доступ в интернет. Выдайте его и попробуйие снова.

**Для Linux**
Наберите команду `python3 webdriver_test.py`

*Пока `webdriver_test.py` не завершится успешно, Sleepsaver работать не сможет. Если вы получаете сообщения об ошибках - копируйте их и ищите решение в Google.*

### Шаг 5: Запускайте программу
**Для Windows**
Наберите команду `python sleepsaver.py` или дважды кликните на файл `sleepsaver.py`

**Для Linux**
Наберите команду `python3 sleepsaver.py`

При первом запуске будут созданы несколько доп. файлов в папке с программой. При первом запуске и каждую неделю программа скачивает расписание с сайта поставщика. Иногда в расписании отсутствует информация о ссылке на курс в Moodle по предмету (в таком виде расписание берется с guide.herzen.spb.ru). В случае отсутствия этих данных программа попросит ввести их вручную. Скопируйте ссылки вручную и вставьте в консоль, они будут сохранены в файле `fillers.json` для следующего раза, когда такой пропуск встретится.

**Следуйте инструкциям на экране и все получится. Хорошего отдыха!**

## Прочее
Помощь в разработке приветствуется, открывайте Issue если найдете баги и отправляйте Merge request если нашли способ их исправить / доработать программу.